# Пакетная регистрация аккаунтов Steam

Это руководство описывает систему для автоматической последовательной регистрации множества аккаунтов Steam из конфигурационного файла.

## Возможности

✅ **Последовательная обработка** - аккаунты регистрируются один за другим
✅ **Отслеживание состояния** - прогресс сохраняется, можно продолжить после прерывания
✅ **Автоматическое решение капчи** - интеграция с YesCaptcha API
✅ **Обработка ошибок** - автоматический retry, пропуск существующих email
✅ **Детальная статистика** - отчёты по успешным и проваленным регистрациям
✅ **Возобновление** - продолжение с места остановки при повторном запуске

## Быстрый старт

### 1. Создайте файл с аккаунтами

Создайте файл `accounts.txt` в корне проекта:

```
# Формат: email:username:password
testuser1@example.com:testuser1:MySecurePass123!
testuser2@example.com:testuser2:AnotherPass456!
testuser3@example.com:testuser3:SuperSecure789!
```

**Важные правила:**
- Один аккаунт на строку
- Формат: `email:username:password` (разделитель - двоеточие)
- Строки начинающиеся с `#` - комментарии (игнорируются)
- Пустые строки игнорируются

### 2. Настройте YesCaptcha (опционально)

Для автоматического решения капчи создайте файл `yescaptcha_config.txt`:

```
YOUR_YESCAPTCHA_API_KEY
```

Или используйте переменную окружения:
```bash
export YESCAPTCHA_API_KEY="your_api_key_here"
```

Если не настроено - используйте флаг `--manual-captcha` для ручного решения.

### 3. Запустите пакетную регистрацию

```bash
# Базовая регистрация (автоматическая капча)
python steam_registration_batch.py

# Или с ручным решением капчи
python steam_registration_batch.py --manual-captcha
```

## Использование

### Основные команды

```bash
# Базовая регистрация с настройками по умолчанию
python steam_registration_batch.py

# Регистрация в headless режиме (без GUI)
python steam_registration_batch.py --headless

# Ручное решение капчи
python steam_registration_batch.py --manual-captcha

# Использование своего файла с аккаунтами
python steam_registration_batch.py --accounts my_accounts.txt

# Настройка задержки между аккаунтами (секунды)
python steam_registration_batch.py --delay 10

# Показать только статистику
python steam_registration_batch.py --stats

# Сбросить провалившиеся аккаунты для повторной попытки
python steam_registration_batch.py --reset-failed
```

### Полный список параметров

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `--accounts FILE` | Путь к файлу с аккаунтами | `accounts.txt` |
| `--headless` | Запуск браузера без GUI | `False` |
| `--manual-captcha` | Решать капчу вручную | `False` |
| `--delay N` | Задержка между аккаунтами (сек) | `5` |
| `--stats` | Показать только статистику | - |
| `--reset-failed` | Сбросить проваленные аккаунты | - |

## Как это работает

### 1. Загрузка аккаунтов

Скрипт загружает список аккаунтов из `accounts.txt`:
- Валидирует формат каждой строки
- Проверяет наличие всех обязательных полей
- Пропускает некорректные строки с предупреждением

### 2. Восстановление состояния

При запуске проверяется наличие `accounts_state.json`:
- **Если существует** - загружается прогресс, продолжение с места остановки
- **Если нет** - создаётся новая очередь из `accounts.txt`

### 3. Последовательная обработка

Для каждого аккаунта выполняется:

1. **Открытие страницы регистрации Steam**
2. **Заполнение email** (с эмуляцией человеческого ввода)
3. **Подтверждение email** (повторный ввод)
4. **Принятие пользовательского соглашения**
5. **Решение hCaptcha** (автоматически или вручную)
6. **Отправка формы**
7. **Проверка успеха** (переход на страницу подтверждения)

### 4. Отслеживание состояния

Каждый аккаунт может находиться в одном из состояний:

| Статус | Описание |
|--------|----------|
| `pending` | Ожидает обработки |
| `in_progress` | В процессе регистрации |
| `email_sent` | Email для подтверждения отправлен |
| `completed` | Успешно зарегистрирован |
| `failed` | Ошибка при регистрации |
| `captcha_failed` | Не удалось решить капчу |
| `email_exists` | Email уже используется в Steam |

### 5. Сохранение результатов

После каждого аккаунта обновляются файлы:

- **`accounts_state.json`** - полное состояние очереди (для возобновления)
- **`completed_accounts.txt`** - список успешно зарегистрированных аккаунтов

## Структура файлов

```
steam_autoreg/
├── accounts.txt                    # Список аккаунтов для регистрации
├── accounts.txt.example            # Пример формата файла
├── accounts_state.json             # Состояние обработки (auto-generated)
├── completed_accounts.txt          # Успешно зарегистрированные (auto-generated)
├── steam_registration_batch.py    # Основной скрипт пакетной регистрации
├── src/utils/account_queue.py     # Модуль управления очередью
└── BATCH_REGISTRATION.md          # Эта документация
```

## Примеры использования

### Пример 1: Базовая регистрация 10 аккаунтов

1. Создайте `accounts.txt`:
```
user1@example.com:user1:Pass123!
user2@example.com:user2:Pass456!
user3@example.com:user3:Pass789!
# ... еще 7 аккаунтов
```

2. Запустите:
```bash
python steam_registration_batch.py
```

3. Скрипт последовательно обработает все аккаунты, выводя статистику:
```
СТАТИСТИКА ОБРАБОТКИ АККАУНТОВ
====================================
Всего аккаунтов:        10
Ожидают обработки:      7
Успешно завершено:      3
Ошибка капчи:           0
Email уже существует:   0
====================================
```

### Пример 2: Возобновление после прерывания

1. Запустите регистрацию:
```bash
python steam_registration_batch.py
```

2. Прервите (Ctrl+C) после 3 аккаунтов

3. Запустите снова - продолжит с 4-го аккаунта:
```bash
python steam_registration_batch.py
# Продолжит с аккаунта №4
```

### Пример 3: Обработка проваленных аккаунтов

1. После завершения посмотрите статистику:
```bash
python steam_registration_batch.py --stats
```

2. Если есть проваленные - сбросьте их:
```bash
python steam_registration_batch.py --reset-failed
```

3. Запустите повторную обработку:
```bash
python steam_registration_batch.py
```

## Обработка ошибок

### Автоматический retry

Система автоматически повторяет попытку регистрации до 3 раз для каждого аккаунта:

- При ошибке капчи - до 3 попыток
- При ошибке регистрации - до 3 попыток
- После 3 неудачных попыток - аккаунт пропускается

### Типы ошибок

**Email уже существует:**
- Статус: `email_exists`
- Аккаунт автоматически пропускается (retry бессмысленен)

**Ошибка капчи:**
- Статус: `captcha_failed`
- Возможный retry (до 3 раз)
- Рекомендация: проверить YesCaptcha API ключ

**Общая ошибка регистрации:**
- Статус: `failed`
- Возможный retry (до 3 раз)
- Детали ошибки сохраняются в `accounts_state.json`

### Логирование

Все важные события логируются в консоль:

```
====================================
РЕГИСТРАЦИЯ АККАУНТА 1/10
====================================
Email: test@example.com
Username: testuser
Попытка: 1
====================================

✓ Страница регистрации открыта
✓ Email успешно заполнен
✓ Подтверждение email заполнено
✓ Соглашение принято
⚠️  Решение капчи...
✓ CAPTCHA решена через YesCaptcha
✓ Продолжение регистрации выполнено
✓ EMAIL УСПЕШНО ОТПРАВЛЕН!
```

## FAQ

### Вопрос: Нужно ли подтверждать email для каждого аккаунта?

**Ответ:** Да, после автоматической регистрации вам нужно:
1. Открыть каждый почтовый ящик
2. Найти письмо от Steam
3. Кликнуть по ссылке подтверждения

Это можно делать параллельно - все email отправлены Steam, вы просто подтверждаете их.

### Вопрос: Можно ли запустить несколько скриптов параллельно?

**Ответ:** Не рекомендуется. Используйте один экземпляр скрипта для последовательной обработки. Параллельная регистрация может:
- Вызвать блокировку по IP
- Привести к конфликтам в файле состояния
- Повысить вероятность детекции автоматизации

### Вопрос: Что делать, если YesCaptcha не справляется с капчей?

**Ответ:** Несколько вариантов:
1. Используйте `--manual-captcha` для ручного решения
2. Проверьте баланс YesCaptcha API
3. Попробуйте другой сервис решения капчи
4. Используйте `--delay 30` для увеличения интервала между запросами

### Вопрос: Как узнать, какие аккаунты успешно зарегистрированы?

**Ответ:** Проверьте файл `completed_accounts.txt`:
```
====================================
Дата: 2025-11-30T15:30:00
Email: test@example.com
Username: testuser
Password: MyPass123!
Попыток: 1
====================================
```

### Вопрос: Можно ли изменить файл accounts.txt во время работы?

**Ответ:** Не рекомендуется. Скрипт загружает аккаунты при запуске. Если нужно добавить аккаунты:
1. Дождитесь завершения текущей обработки
2. Добавьте новые аккаунты в `accounts.txt`
3. Удалите `accounts_state.json`
4. Запустите скрипт заново

## Безопасность

⚠️ **ВАЖНО:**

- Никогда не коммитьте `accounts.txt` в git (уже в .gitignore)
- Храните `yescaptcha_config.txt` в безопасности (уже в .gitignore)
- Используйте уникальные пароли для каждого аккаунта
- Регулярно делайте резервные копии `completed_accounts.txt`

## Архитектура

### Модуль `src/utils/account_queue.py`

**Класс `AccountQueue`:**
- Управляет очередью аккаунтов
- Сохраняет/загружает состояние из JSON
- Отслеживает статус каждого аккаунта
- Предоставляет статистику

**Класс `AccountData`:**
- Хранит данные одного аккаунта
- Статус обработки
- Количество попыток
- Сообщения об ошибках

### Скрипт `steam_registration_batch.py`

**Класс `SteamBatchRegistration`:**
- Оркестрирует процесс пакетной регистрации
- Использует `SteamRegistration` для каждого аккаунта
- Обрабатывает ошибки и обновляет статусы
- Выводит статистику

## Поддержка

Если возникли проблемы:

1. Проверьте формат `accounts.txt`
2. Убедитесь, что YesCaptcha API ключ валиден
3. Посмотрите `accounts_state.json` для деталей ошибок
4. Используйте `--stats` для просмотра текущего состояния
5. Попробуйте `--reset-failed` для повторной попытки

## Лицензия

⚠️ **Это исследовательский проект для тестирования технологий обхода детекции.**

**НЕ используйте для:**
- Нарушения условий использования Steam
- Массовой регистрации для спама
- Любой незаконной деятельности

Используйте только для:
- Образовательных целей
- Тестирования собственных аккаунтов
- Исследования технологий автоматизации
