# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Описание проекта

Это проект для автоматизированного тестирования браузера с использованием стелс-технологий на примере Steam. Проект включает в себя модули для обхода детекции автоматизации, генерации реалистичных browser fingerprints, эмуляции человеческого поведения и работы с прокси.

⚠️ **ВАЖНО**: Это исследовательский проект для тестирования технологий обхода детекции. НЕ используйте для нарушения условий использования сервисов.

## Архитектура

### Основные компоненты

1. **steam_test_stealth.py** - главный скрипт для запуска тестового браузера со стелс-функциями:
   - Класс `SteamTestStealth` управляет сессией браузера
   - Функция `refresh_proxy_ip()` обновляет IP мобильных прокси через API
   - Функция `detect_proxy_geo()` определяет геолокацию прокси
   - Адаптеры для человекоподобного ввода и движений мыши

2. **src/stealth/** - модули для обхода детекции:
   - `fingerprint_generator.py` - генерация уникальных browser fingerprints (WebGL, hardware, viewport)
   - `cookie_generator.py` - создание реалистичных cookies с историей посещений
   - `storage_generator.py` - генерация localStorage данных для имитации реального браузера
   - `human_typing.py` - эмуляция человеческого набора текста с опечатками
   - `human_mouse.py` - эмуляция человеческих движений мыши по кривым Безье
   - `geo_config.py` - конфигурации геолокации для разных стран

3. **firefox_antidetect_extension/** - расширение Firefox для скрытия navigator.webdriver:
   - `manifest.json` - манифест расширения
   - `content_script.js` - скрипт, инжектируемый в страницы для скрытия признаков автоматизации

## Команды разработки

```bash
# Запуск тестового браузера (откроется Firefox со стелс-функциями)
python steam_test_stealth.py

# Запуск без прокси
python steam_test_stealth.py --no-proxy

# Запуск в headless режиме (без GUI)
python steam_test_stealth.py --headless
```

## Конфигурационные файлы

- **proxies.txt** - список прокси (по одному на строку в формате login:pass@host:port или host:port:login:pass)
- **proxy_config.txt** - URL для обновления IP мобильных прокси (API endpoint)

## Зависимости

Основные зависимости проекта:
- selenium - автоматизация браузера
- requests - HTTP запросы для работы с API прокси и геолокации

## Ключевые особенности реализации

### Обход детекции WebDriver

Проект использует двухуровневый подход:
1. Firefox extension инжектирует код на уровне document_start (до загрузки страницы)
2. JavaScript injection через Selenium после загрузки для дополнительных модификаций

### Генерация Fingerprint

`FingerprintGenerator` создаёт согласованные профили с реалистичными комбинациями:
- WebGL vendor/renderer специфичные для браузера (Chrome использует ANGLE, Firefox - нативные драйверы)
- Hardware конфигурации (cores, memory) соответствуют современным системам
- Viewport использует только популярные разрешения для уменьшения уникальности

### Работа с прокси

Поддерживаются HTTP и SOCKS5 прокси с автоматическим определением формата. При использовании мобильных прокси происходит:
1. Обновление IP через API перед запуском браузера
2. Определение геолокации нового IP
3. Настройка locale, timezone и currency в соответствии с геолокацией

### Человекоподобное поведение

- **HumanTypist**: эмулирует реалистичную скорость печати с вариативными задержками и опечатками
- **HumanMouse**: движения по кривым Безье с случайными отклонениями и ускорениями

## Тестирование стелс-функций

Браузер открывается на странице Steam и остаётся активным для ручной проверки:
1. Откройте консоль разработчика (F12) и проверьте `navigator.webdriver` (должен быть undefined)
2. Проверьте fingerprint на pixelscan.net или других детекторах
3. Проверьте работу прокси и геолокацию

## Структура данных прокси

Поддерживаемые форматы в proxies.txt:
- `login:pass@host:port` - стандартный формат
- `host:port:login:pass` - альтернативный формат
- `socks5://login:pass@host:port` - SOCKS5 прокси
- `http://login:pass@host:port` - HTTP прокси с явным указанием протокола